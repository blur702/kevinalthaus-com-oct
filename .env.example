# Environment Configuration
# Copy this file to .env and fill in your values
# DO NOT commit .env to version control

# Application Environment
NODE_ENV=development

# API Gateway
API_GATEWAY_PORT=3000
API_GATEWAY_HOST=localhost
API_GATEWAY_URL=http://localhost:3000

# Script Auth (for local utility scripts)
# Used by create-internet-regulation-page.js
API_HOST=localhost
API_PORT=3000
API_USERNAME=
API_PASSWORD=

# Main Application
MAIN_APP_PORT=3001
MAIN_APP_HOST=localhost
MAIN_APP_URL=http://localhost:3001

# Frontend Application
# Base URL of the frontend application for constructing password reset links in emails
# Development: http://localhost:5173 (or your frontend dev server port)
# Production: https://app.example.com (your production frontend URL)
FRONTEND_URL=http://localhost:5173

# Python Service
PYTHON_SERVICE_PORT=8000
PYTHON_ENV=development
PYTHON_SERVICE_URL=http://localhost:8000

# Database Configuration
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=changeme_secure_password
POSTGRES_DB=kevinalthaus

# Database URL (constructed from above values)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# PostgreSQL SSL Mode
# Options: disable (no SSL), prefer (try SSL, fallback to no SSL), require (require SSL),
#          verify-ca (require SSL and verify CA), verify-full (require SSL and verify host)
# Development: prefer (attempts SSL but falls back for local dev without certs)
# Production: require or verify-full (enforce SSL for security)
PGSSLMODE=prefer

# PostgreSQL SSL Root Certificate (required if PGSSLMODE is verify-ca or verify-full)
# Path to the root CA certificate file for SSL verification
# Example: /path/to/root.crt or ./secrets/postgres-ca.crt
# PGSSLROOTCERT=/path/to/root.crt

# Migration Lock Namespace
# Used to derive advisory lock ID for database migrations to prevent collisions
# If multiple applications share the same database, each should use a unique namespace
# Default: kevinalthaus-com-oct (change if you have multiple apps on same DB)
MIGRATION_LOCK_NAMESPACE=kevinalthaus-com-oct

# Migration Lock ID (optional)
# Explicit 32-bit signed integer for PostgreSQL advisory lock
# If not set, ID is derived from MIGRATION_LOCK_NAMESPACE via SHA256
# Use this to manually resolve conflicts across environments or databases
# Example: MIGRATION_LOCK_ID=123456789
# MIGRATION_LOCK_ID=

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_URL=redis://localhost:6379

# HashiCorp Vault Configuration
# Used for storing sensitive settings like API keys, passwords, etc.
# Development: Run Vault in dev mode with: vault server -dev
# Production: Use production Vault cluster with proper authentication
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=dev-only-token
VAULT_NAMESPACE=
# Vault authentication method: token (default), approle, kubernetes
VAULT_AUTH_METHOD=token
# For AppRole authentication (production recommended)
VAULT_ROLE_ID=
VAULT_SECRET_ID=
# Connection settings
VAULT_MAX_RETRIES=3
VAULT_TIMEOUT=10000

# Security
# CRITICAL REQUIREMENT: All secret values below MUST be set before starting services
# Services will FAIL TO START if JWT_SECRET or SESSION_SECRET are missing/empty
# Generate secure random strings for production for ALL secret values below
# (JWT_SECRET, SESSION_SECRET, CSRF_SECRET, ENCRYPTION_KEY, PLUGIN_SIGNATURE_SECRET, INTERNAL_GATEWAY_TOKEN)
# Use: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# Or use: openssl rand -hex 32
# DO NOT use the placeholder values below in production - generate your own!
JWT_SECRET=REPLACE_WITH_SECURE_RANDOM_32_PLUS_CHAR_STRING
JWT_EXPIRES_IN=7d
SESSION_SECRET=REPLACE_WITH_SECURE_RANDOM_32_PLUS_CHAR_STRING
CSRF_SECRET=REPLACE_WITH_SECURE_RANDOM_32_PLUS_CHAR_STRING

# Password Reset Configuration
# Token expiry in minutes (default: 30, min: 1, max: 1440 [24 hours])
PASSWORD_RESET_TOKEN_EXPIRY_MINUTES=30
# Number of recent passwords to check for reuse (default: 3, min: 1, max: 10)
PASSWORD_HISTORY_LIMIT=3
# Internal Gateway Token: Used to verify requests originate from the API gateway
# This prevents direct access to internal services and header spoofing
# Must be shared between api-gateway and all internal services (main-app, python-service, plugin-engine)
INTERNAL_GATEWAY_TOKEN=REPLACE_WITH_SECURE_RANDOM_32_PLUS_CHAR_STRING
# Optional: Path to persist CSRF secret in development (default: .csrf-secret in project root)
# In development, if CSRF_SECRET is not set, a random secret will be generated and saved to this file
# This file should be added to .gitignore
CSRF_SECRET_FILE=.csrf-secret
ENCRYPTION_KEY=REPLACE_WITH_SECURE_RANDOM_32_PLUS_CHAR_STRING

# Plugin System
PLUGIN_UPLOAD_MAX_SIZE=52428800
PLUGIN_DIRECTORY=./plugins
# See Security section above for instructions on generating secure random strings
PLUGIN_SIGNATURE_SECRET=REPLACE_WITH_SECURE_RANDOM_32_PLUS_CHAR_STRING

# CORS Configuration
CORS_ORIGIN=http://localhost:3001,http://localhost:3000
# NOTE: If CORS_ORIGIN includes '*', credentials (cookies/authorization) are automatically disabled
# and origin will be set to '*' by the servers to comply with CORS requirements.
CORS_CREDENTIALS=true

# Admin CSRF Protection
# Comma-separated list of allowed origins for admin panel CSRF validation
# These should match the domains where the admin UI is hosted
# Examples: http://localhost:3003,https://admin.example.com,https://admin.example.org
ADMIN_ALLOWED_ORIGINS=http://localhost:3003,https://localhost:3003

# Cookie Configuration
# COOKIE_SAMESITE controls the SameSite attribute for authentication cookies
# Options: lax (default, best for most cases), strict (more restrictive), none (requires HTTPS)
# Use 'lax' for typical same-site applications (allows top-level navigation)
# Use 'strict' for maximum CSRF protection (blocks all cross-site cookie sending)
# Use 'none' for cross-site scenarios (requires secure=true, HTTPS only)
# When set to 'none', secure flag is automatically enabled regardless of NODE_ENV
COOKIE_SAMESITE=lax

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
ENABLE_REQUEST_LOGGING=true
# Query Log Sampling: Log every Nth successful database query (default: 10)
# Set LOG_LEVEL=debug to log all queries regardless of sample rate
# Higher values reduce log noise in production (e.g., 100 = log 1% of queries)
QUERY_LOG_SAMPLE_RATE=10
# Query Fingerprint Secret: Used for HMAC-based query fingerprinting in logs (required in production)
# Generate using: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
FINGERPRINT_SECRET=REPLACE_WITH_SECURE_RANDOM_32_PLUS_CHAR_STRING

# File Uploads
UPLOAD_MAX_SIZE=10485760
UPLOAD_DIRECTORY=./uploads
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,image/webp,application/pdf

# Email Configuration (Brevo)
# Brevo API key is stored in HashiCorp Vault for security
# The settings UI will encrypt and store the key in Vault
BREVO_API_KEY_VAULT_PATH=secret/email/brevo
SMTP_FROM_EMAIL=noreply@kevinalthaus.com
SMTP_FROM_NAME=Kevin Althaus

# Legacy SMTP Configuration (deprecated - use Brevo instead)
# These are kept for backward compatibility only
SMTP_HOST=
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=
SMTP_PASSWORD=

# External Services (optional)
# Add any third-party API keys or service credentials here
# EXAMPLE_API_KEY=
# EXAMPLE_API_SECRET=

# Feature Flags
ENABLE_PLUGIN_SYSTEM=true
ENABLE_THEME_SYSTEM=true
ENABLE_API_DOCS=true
ENABLE_METRICS=true

# Admin test credentials (local only; do not use in prod)
# Used for local testing of admin features and scripts
ADMIN_TEST_USERNAME=
ADMIN_TEST_PASSWORD=

# Analytics Configuration
# Enable/disable page view tracking (default: true)
ANALYTICS_ENABLED=true
# Anonymize IP addresses for GDPR compliance (default: true)
# When enabled, IPv4 last octet and IPv6 last 80 bits are masked
ANALYTICS_IP_ANONYMIZE=true
# Track authenticated users (default: true)
# Set to false to only track anonymous visitors
ANALYTICS_TRACK_AUTHENTICATED=true
# Comma-separated list of paths to exclude from tracking (default: health checks)
# Example: /health,/health/live,/health/ready,/static,/assets
ANALYTICS_EXCLUDED_PATHS=/health,/health/live,/health/ready

# Performance
NODE_OPTIONS=--max-old-space-size=4096
UV_THREADPOOL_SIZE=4

# Security Headers
HELMET_CSP_ENABLED=true
HELMET_HSTS_ENABLED=true

# Monitoring (optional)
# Sentry Error Tracking
# Production DSN from https://sentry.io
VITE_SENTRY_DSN=YOUR_SENTRY_DSN_HERE
# Application version for release tracking
VITE_APP_VERSION=1.0.0
# Sentry Source Map Upload (optional, for better production stack traces)
# Get auth token from: https://sentry.io/settings/account/api/auth-tokens/
# Required scopes: project:read, project:write, project:releases
# SENTRY_AUTH_TOKEN=sntrys_YOUR_TOKEN_HERE
# SENTRY_ORG=your-org-slug
# SENTRY_PROJECT=your-project-slug
# NEW_RELIC_LICENSE_KEY=
# DATADOG_API_KEY=
